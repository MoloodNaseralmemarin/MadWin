@using MadWin.Core.DTOs.Orders
@using Shop2City.Core.Convertors
@model IEnumerable<OrderSummaryDto>

@{
    ViewData["Title"] = "سفارش‌های من";
}

<style>
    .breadcrumb {
        display: flex;
        flex-wrap: wrap;
        list-style: none;
        padding: 10px 16px;
        background-color: #f8f9fa;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 20px;
    }

        .breadcrumb li + li::before {
            content: "›";
            margin: 0 8px;
            color: #6c757d;
        }

        .breadcrumb li a {
            color: #007bff;
            text-decoration: none;
        }

        .breadcrumb li:last-child a {
            color: #495057;
            pointer-events: none;
            font-weight: bold;
        }

    .order-table thead {
        background-color: #e9ecef;
    }

    .order-table th, .order-table td {
        padding: 10px;
        text-align: center;
        font-size: 14px;
    }

    .order-table tbody tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    .badge-success {
        background-color: #28a745;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
    }

    .badge-warning {
        background-color: #ffc107;
        color: black;
        padding: 4px 8px;
        border-radius: 4px;
    }
</style>

<div class="container mt-4">
    <ul class="breadcrumb">
        <li><a asp-controller="Home" asp-action="Index"><i class="fa fa-home"></i></a></li>
        <li><a href="#">سبد خرید</a></li>
    </ul>

    <h2 class="mb-4">سفارش‌های من</h2>

    <div class="table-responsive">
        <table class="table table-bordered order-table">
            <thead>
                <tr>
                    <th>تاریخ</th>
                    <th>زمان</th>
                    <th>محصول</th>
                    <th>ابعاد</th>
                    <th>تعداد قطعات</th>
                    <th>وضعیت</th>
                    <th>قیمت واحد</th>
                    <th>تعداد</th>
                    <th>قیمت کل</th>
                    <th>تسویه</th>
                    <th>جزئیات</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr class="@(item.IsFinaly ? "bg bg-success" : "")">
                        <td>@item.CreateDate.ToShamsi()</td>
                        <td>@item.CreateDate.ToString("HH:mm:ss")</td>
                        <td>@item.CategoryGroup</td>
                        <td>@item.Size</td>
                        <td>@item.PartCount</td>
                        <td>
                            @if (item.IsEqualParts)
                            {
                                <span class="badge badge-success">قطعات مساوی</span>
                            }
                            else
                            {
                                <span class="badge badge-warning">قطعات مختلف</span>
                            }
                        </td>
                        <td>@item.PriceWithFee.ToString("N0") ریال</td>
                        <td>@item.Count</td>
                        <td>@item.SubtotalPrice.ToString("N0") ریال</td>
                        <td>@(item.IsFinaly ? "تسویه شد" : "تسویه نشده است")</td>
                        <td>
                            <button class="btn btn-outline-secondary btn-sm" type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#parts-@item.OrderId"
                                    aria-expanded="false"
                                    aria-controls="parts-@item.OrderId">
                                نمایش
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="10" class="p-0">
                            <div class="collapse" id="parts-@item.OrderId">
                                <div class="p-3 bg-light text-start">
                                    <ul class="mb-0">
                                        @for (int i = 0; i < item.WidthParts.Count; i++)
                                        {
                                            string position;
                                            if (item.WidthParts.Count == 3)
                                            {
                                                position = i == 0 ? "چپ" : i == 1 ? "میانه" : "راست";
                                            }
                                            else
                                            {
                                                position = (i % 2 == 0) ? "راست" : "چپ";
                                            }

                                            <li>
                                                قطعه @(i + 1): عرض = @item.WidthParts[i].WidthValue، موقعیت نصب = @position
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="text-end mt-4">
        <a asp-area="UserPanel" asp-controller="Home" asp-action="Index" class="btn btn-primary btn-lg">
            <i class="fa fa-plus"></i> سفارش جدید
        </a>
    </div>
</div>
